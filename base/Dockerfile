FROM python:3.10.5-alpine
LABEL maintainer="craig@2deviate.com"

ARG IMAGE_TAG
ARG LOGFILENAME
ARG LOGLEVEL
ARG FLASK_APP
ARG FLASK_ENV
ARG FLASK_PORT
ARG FLASK_HOST
ARG FLASK_DEBUG
ARG FLASK_APP_TEMPLATE_NAME
ARG FLASK_APP_UPLOAD_FOLDER
ARG FLASK_APP_DOWNLOAD_FOLDER
ARG FLASK_FILE_UPLOAD_MAX_LENGTH
ARG MYSQL_USER
ARG MYSQL_PASSWORD
ARG MYSQL_DATABASE
ARG MYSQL_HOST
ARG MYSQL_PORT
ARG MYSQL_ROOT_PASSWORD
ARG DOCKER_DB_NAME
ARG DOCKER_SERVER_NAME
ARG DOCKER_PROXY_NAME
ARG GOOGLE_MAPS_API_KEY
ARG SMTP_USER
ARG SMTP_PASSWORD
ARG SMTP_HOST
ARG SMTP_PORT
ARG EMAIL_FROM_ADDRESS
ARG EMAIL_CC_ADDRESSES
ARG EMAIL_ATTACHMENT
ARG EMAIL_SUBJECT
ARG EMAIL_TEMPLATE_TEXT
ARG EMAIL_TEMPLATE_HTML
ARG EMAIL_TEMPLATE_SCHEMA
ARG PROXY_SERVER

ENV IMAGE_TAG=${IMAGE_TAG}
ENV LOGFILENAME=${LOGFILENAME}
ENV LOGLEVEL=${LOGLEVEL}
ENV FLASK_APP=${FLASK_APP}
ENV FLASK_ENV=${FLASK_ENV}
ENV FLASK_HOST=${FLASK_HOST}
ENV FLASK_PORT=${FLASK_PORT}
ENV FLASK_DEBUG=${FLASK_DEBUG}
ENV FLASK_APP_TEMPLATE_NAME=${FLASK_APP_TEMPLATE_NAME}
ENV FLASK_APP_UPLOAD_FOLDER=${FLASK_APP_UPLOAD_FOLDER}
ENV FLASK_APP_DOWNLOAD_FOLDER=${FLASK_APP_DOWNLOAD_FOLDER}
ENV FLASK_FILE_UPLOAD_MAX_LENGTH=${FLASK_FILE_UPLOAD_MAX_LENGTH}
ENV MYSQL_USER=${MYSQL_USER}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}
ENV MYSQL_DATABASE=${MYSQL_DATABASE}
ENV MYSQL_HOST=${MYSQL_HOST}
ENV MYSQL_PORT=${MYSQL_PORT}
ENV DOCKER_DB_NAME=${DOCKER_DB_NAME}
ENV DOCKER_SERVER_NAME=${DOCKER_SERVER_NAME}
ENV DOCKER_PROXY_NAME=${DOCKER_PROXY_NAME}
ENV GOOGLE_MAPS_API_KEY=${GOOGLE_MAPS_API_KEY}
ENV SMTP_USER=${SMTP_USER}
ENV SMTP_PASSWORD=${SMTP_PASSWORD}
ENV SMTP_HOST=${SMTP_HOST}
ENV SMTP_PORT=${SMTP_PORT}
ENV EMAIL_FROM_ADDRESS=${EMAIL_FROM_ADDRESS}
ENV EMAIL_CC_ADDRESSES=${EMAIL_CC_ADDRESSES}
ENV EMAIL_ATTACHMENT=${EMAIL_ATTACHMENT}
ENV EMAIL_SUBJECT=${EMAIL_SUBJECT}
ENV EMAIL_TEMPLATE_TEXT=${EMAIL_TEMPLATE_TEXT}
ENV EMAIL_TEMPLATE_HTML=${EMAIL_TEMPLATE_HTML}
ENV EMAIL_TEMPLATE_SCHEMA=${EMAIL_TEMPLATE_SCHEMA}
ENV PROXY_SERVER=${PROXY_SERVER}

USER root

# define arg for dynamic args
ARG GOOGLE_MAPS_API_KEY
# environment variables
ENV GOOGLE_MAPS_API_KEY=${GOOGLE_MAPS_API_KEY}

# define busybox init scripts for cron
RUN apk upgrade --available
RUN apk add --no-cache openrc busybox-initscripts
RUN rc-update add crond

# add bash for boot cmd
RUN apk add bash curl sudo

RUN apk update && \
    apk add --virtual build-dependencies \
    build-base \
    gcc \
    wget \
    git \
    alpine-sdk \
    libffi-dev \ 
    openssl-dev \
    build-base

RUN apk add --no-cache aws-cli

RUN apk --update add --no-cache g++

RUN pip install pandas
